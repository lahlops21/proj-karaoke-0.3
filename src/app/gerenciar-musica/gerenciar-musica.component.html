<div class="container">
  <!-- Botão voltar -->
  <button class="btn-voltar" (click)="voltarParaPainel()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="m15 18-6-6 6-6"/>
    </svg>
    Voltar ao Painel
  </button>

  <!-- Card principal -->
  <div class="card">
    <!-- Header -->
    <div class="header">
      <h2 class="titulo">Gerenciar Músicas</h2>
      <p class="subtitulo">Edite ou exclua músicas do catálogo</p>
    </div>

    <!-- Mensagem de sucesso -->
    <div *ngIf="sucesso()" class="mensagem-sucesso">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span>✨ Operação realizada com sucesso!</span>
    </div>

    <!-- Mensagem de erro -->
    <div *ngIf="erro()" class="mensagem-erro">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>{{ erro() }}</span>
    </div>

    <!-- Busca por código -->
    <div class="busca-section">
      <h3 class="secao-titulo">Buscar Música</h3>
      <form [formGroup]="formBusca" (ngSubmit)="buscarMusica()" class="form-busca">
        <div class="busca-wrapper">
          <svg class="busca-icone" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            formControlName="codigo"
            placeholder="Digite o código da música"
            class="input-busca"
          />
          <button 
            type="submit" 
            class="btn-buscar"
            [disabled]="formBusca.invalid || buscando()"
          >
            <svg *ngIf="!buscando()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <span *ngIf="buscando()" class="loading-spinner-small"></span>
            <span>{{ buscando() ? 'Buscando...' : 'Buscar' }}</span>
          </button>
        </div>
      </form>
    </div>

    
    <div class="edicao-section">
      <h3 class="secao-titulo">Editar Informações</h3>
      
      <form [formGroup]="formEdicao">
        <!-- Título -->
        <div class="form-group">
          <label for="titulo">Título da Música <span class="obrigatorio">*</span></label>
          <input 
            id="titulo" 
            type="text" 
            formControlName="titulo" 
            placeholder="Ex: Evidências"
            [class.input-erro]="formEdicao.controls.titulo.invalid && formEdicao.controls.titulo.touched"
          />
        </div>

        <!-- Código -->
        <div class="form-group">
          <label for="codigo_musica">Código da Música <span class="obrigatorio">*</span></label>
          <input 
            id="codigo_musica" 
            type="text" 
            formControlName="codigo_musica" 
            placeholder="Ex: 12345"
            [class.input-erro]="formEdicao.controls.codigo_musica.invalid && formEdicao.controls.codigo_musica.touched"
          />
        </div>

        <!-- Intérprete -->
        <div class="form-group">
          <label for="interprete_musica">Intérprete <span class="obrigatorio">*</span></label>
          <input 
          id="interprete_musica" 
          type="text" 
          formControlName="interprete_musica" 
          placeholder="Ex: Sandy"
          [class.input-erro]="formEdicao.controls.interprete_musica.invalid && formEdicao.controls.interprete_musica.touched"
          />
        </div>

        <!-- Letra -->
        <div class="form-group">
          <label for="letra_musica">Letra da Música</label>
          <textarea 
            id="letra_musica" 
            formControlName="letra_musica" 
            placeholder="Letra completa da música..."
            rows="6"
          ></textarea>
        </div>

        <!-- Botões de ação -->
        <div class="botoes-container">
          <button 
            type="button" 
            class="btn-cancelar" 
            (click)="cancelar()"
            [disabled]="salvando() || excluindo()"
          >
            Cancelar
          </button>
          
          <button 
            type="button" 
            class="btn-salvar" 
            (click)="abrirModalEdicao()"
            [disabled]="formEdicao.invalid || salvando() || excluindo()"
            [class.loading]="salvando()"
          >
            <svg *ngIf="!salvando()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span *ngIf="!salvando()">Salvar Alterações</span>
            <span *ngIf="salvando()" class="loading-spinner"></span>
          </button>
        </div>

        <!-- Botão excluir -->
        <div class="excluir-section">
          <button 
            type="button" 
            class="btn-excluir" 
            (click)="abrirModalExclusao()"
            [disabled]="salvando() || excluindo()"
            [class.loading]="excluindo()"
          >
            <svg *ngIf="!excluindo()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
            <span *ngIf="!excluindo()">Excluir Música</span>
            <span *ngIf="excluindo()" class="loading-spinner"></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Confirmar Edição -->
  <div *ngIf="modalConfirmarEdicao()" class="modal-overlay" (click)="fecharModalEdicao()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <svg class="modal-icone warning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <h3 class="modal-titulo">Confirmar Alterações</h3>
      </div>
      <p class="modal-texto">
        Tem certeza que deseja salvar essas alterações? 
        <strong>Essas mudanças impactarão na forma como os usuários buscarão e encontrarão esta música.</strong>
      </p>
      <div class="modal-botoes">
        <button class="btn-modal-cancelar" (click)="fecharModalEdicao()">
          Cancelar
        </button>
        <button class="btn-modal-confirmar" (click)="confirmarEdicao()">
          Confirmar Alterações
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Confirmar Exclusão -->
  <div *ngIf="modalConfirmarExclusao()" class="modal-overlay" (click)="fecharModalExclusao()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <svg class="modal-icone danger" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <h3 class="modal-titulo">Confirmar Exclusão</h3>
      </div>
      <p class="modal-texto">
        Tem certeza que deseja excluir esta música? 
        <strong>Esta ação é irreversível e os usuários não poderão mais encontrar esta música no catálogo.</strong>
      </p>
      <div class="modal-botoes">
        <button class="btn-modal-cancelar" (click)="fecharModalExclusao()">
          Cancelar
        </button>
        <button class="btn-modal-excluir" (click)="confirmarExclusao()">
          Excluir Música
        </button>
      </div>
    </div>
  </div>

  <!-- Efeito de fundo -->
  <div class="efeito-fundo"></div>
</div>
